{
    "type": "Ext.form.Panel",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "cls": [
            "EMAType"
        ],
        "designer|userClassName": "EMAType1",
        "scrollable": "vertical"
    },
    "designerId": "7d969f35-80f6-497f-9677-8bc260ef4b83",
    "cn": [
        {
            "type": "Ext.Label",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "html": "What is happening right now?",
                "itemId": "question",
                "margin": "8px"
            },
            "designerId": "8d96d19e-8686-48e7-bd04-cafa30c058e9"
        },
        {
            "type": "Ext.form.FieldSet",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "goola": "ema",
                "docked": null,
                "itemId": "fset",
                "hideOnMaskTap": false,
                "modal": false,
                "instructions": null,
                "title": null
            },
            "designerId": "9ad08515-b391-4810-99e2-f9c0971e0a2b",
            "customConfigs": [
                {
                    "group": "(Custom Properties)",
                    "name": "goola",
                    "type": "string"
                }
            ],
            "cn": [
                {
                    "type": "Ext.field.Slider",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "itemId": "stress",
                        "label": "How much stress are you experiencing in this moment? <div><span style=\"float:right\">a lot</span><span>none</span></span>",
                        "labelAlign": "top",
                        "labelWrap": true,
                        "name": "stress",
                        "value": [
                            50
                        ]
                    },
                    "designerId": "8e631a67-460d-4e9b-b9e5-6f12d0b6020d"
                },
                {
                    "type": "Ext.Button",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "action": "exercise",
                        "disabled": null,
                        "itemId": "done",
                        "autoEvent": null,
                        "text": "Done"
                    },
                    "designerId": "43994e75-d9e0-4b3c-8fc0-38a5b9c10a07",
                    "customConfigs": [
                        {
                            "group": "(Custom Properties)",
                            "name": "action",
                            "type": "string"
                        }
                    ],
                    "cn": [
                        {
                            "type": "basiceventbinding",
                            "reference": {
                                "name": "listeners",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "fn": "onDoneTap",
                                "implHandler": [
                                    "stress=button.parent.child('#stress').getValue();",
                                    "",
                                    "user = HEART.getItem('local', 'user');",
                                    "user = JSON.parse(user);",
                                    "",
                                    "user.stress=stress;",
                                    "",
                                    "user = JSON.stringify(user);",
                                    "HEART.setItem('local', 'user', user);",
                                    "",
                                    "if(this.goola=='followup'){return;}",
                                    "",
                                    "",
                                    "if(stress>50){",
                                    "",
                                    "\tif(this.goola=='stressed'){",
                                    "",
                                    "\t\tsetTimeout(function(){",
                                    "",
                                    "\t\t\tform = Ext.create('HEART.view.EMAType6');",
                                    "\t\t\tform.emxType = 'EMAType6';",
                                    "\t\t\tform.goola = 'stressed';",
                                    "",
                                    "\t\t\tExt.Viewport.getActiveItem().setActiveItem(2);",
                                    "\t\t\tExt.Viewport.getActiveItem().getActiveItem().push(form);",
                                    "",
                                    "\t\t}, 1000*60*30);",
                                    "",
                                    "\t}else{",
                                    "",
                                    "\t\tEMX = ['EMITensionCheck', 'EMIGeneralMindfulness', 'EMIAudio4', 'EMIAudio7'];",
                                    "",
                                    "\t\ttype = EMX[Math.floor(EMX.length*Math.random())]; ",
                                    "",
                                    "\t\tform = Ext.create('HEART.view.'+type);",
                                    "",
                                    "\t\tExt.Viewport.getActiveItem().setActiveItem(2);",
                                    "\t\tExt.Viewport.getActiveItem().getActiveItem().push(form);",
                                    "",
                                    "\t\tif(Math.random()<1/3){",
                                    "\t\t\t",
                                    "\t\t\temx = this.emxType;",
                                    "",
                                    "\t\t\tsetTimeout(function(){",
                                    "",
                                    "\t\t\t\tform = Ext.create('HEART.view.'+emx);",
                                    "\t\t\t\tform.emxType = emx;",
                                    "\t\t\t\tform.goola = 'followup';",
                                    "",
                                    "\t\t\t\tExt.Viewport.getActiveItem().setActiveItem(2);",
                                    "\t\t\t\tExt.Viewport.getActiveItem().getActiveItem().push(form);",
                                    "",
                                    "\t\t\t}, 1000*60*15);",
                                    "",
                                    "\t\t\tsetTimeout(function(){",
                                    "",
                                    "\t\t\t\tuser = HEART.getItem('local', 'user');",
                                    "\t\t\t\tuser = JSON.parse(user);",
                                    "",
                                    "\t\t\t\tif(user.stress>50){",
                                    "",
                                    "\t\t\t\t\tform = Ext.create('HEART.view.'+emx);",
                                    "\t\t\t\t\tform.emxType = emx;",
                                    "\t\t\t\t\tform.goola = 'followup';",
                                    "",
                                    "\t\t\t\t\tExt.Viewport.getActiveItem().setActiveItem(2);",
                                    "\t\t\t\t\tExt.Viewport.getActiveItem().getActiveItem().push(form);",
                                    "\t\t\t\t}",
                                    "",
                                    "",
                                    "\t\t\t}, 1000*60*30);",
                                    "",
                                    "\t\t}\t",
                                    "",
                                    "\t}",
                                    "",
                                    "}",
                                    "",
                                    "mylog = JSON.parse(HEART.getItem('local', 'mylog'))||{};",
                                    "",
                                    "dead = new Date(Date.now()-Date.now()%(1000*60*60*24*7)+(1000*60*60*24*10));",
                                    "",
                                    "if(mylog.expire){",
                                    "\tif(Date.now()>mylog.expire){",
                                    "\t\tmylog = {};",
                                    "\t\tmylog.expire = dead;",
                                    "\t}",
                                    "",
                                    "}else{",
                                    "\tmylog.expire = dead",
                                    "}",
                                    "",
                                    "stressed = mylog.stressed||{high: stress, low: stress, average: stress, count: 0};",
                                    "",
                                    "if(stress>stressed.high){",
                                    "\tstressed.high=stress;",
                                    "}else if(stress<stressed.low){",
                                    "\tstressed.low=stress",
                                    "}",
                                    "",
                                    "stressed.average-=0;",
                                    "stressed.count-=0;",
                                    "stress-=0;",
                                    "",
                                    "stressed.average=(stressed.average*stressed.count+stress)/(stressed.count+1);",
                                    "",
                                    "stressed.count+=1;",
                                    "",
                                    "mylog.stressed=stressed;",
                                    "",
                                    "mylog = JSON.stringify(mylog);",
                                    "HEART.setItem('local', 'mylog', mylog);"
                                ],
                                "delay": null,
                                "single": null,
                                "name": "tap"
                            },
                            "designerId": "e29e96a8-b3cc-46c2-9a07-3b3cb814802d"
                        }
                    ]
                }
            ]
        }
    ]
}